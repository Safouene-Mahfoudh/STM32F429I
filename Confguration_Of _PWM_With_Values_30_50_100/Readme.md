#### PWM : Pulse Width Modulation

PWM allows the output of a periodic signal with a impulse that can be controlled. It is called Duty-cycle. A PWM signal is generated by a TIMER.  

A TIMER can be used in several modes:  

- Inputcapture: Measure the duration of a pulse of an input signal.
- Output compare: Generation of periodic signals.
- PWM: Pulse width modulation of signals.
- One pulse: Generate one pulse at the output.

The PWM option allows the output of a periodic signal with a pulse of which one can control the duration (Duty Cycle).This duration can vary from 0 to T.  
So the PWM period is obtained by configuring the TIMER period using the registers **prescaler** and **reload** (Autoreload). While the duration of the pulse is fixed at using the **comparison** register.  

The TIMER allows to generate of a signal whose frequency and duty cycle are controllable by registers. We can then generate a signal whose pulse width is modulated (PWM). The register **TIMx_ARR** (counter) allows to set the frequency while that **the TIMx_CCRx** register controls the duty cycle.  

The example bellow show how you can calculate a PWM signal period :  

**TIM_Period = timer_tick_frequency / PWM_frequency - 1**

* timer_tick_frequency : bus frequency **APB1_TIMER_Clocks**
* TIM_Period : numerical value to put in **Counter Period(AutoReloadReg)**
* Pulse (32 bits value) contains the value of the duty cycle.

The calculated value of TIM_Period must be less than 65535 which represents the value maximum that can be put in a 16-bit register. In order to meet this requirement, you will need to choose **Prescaler** in **Counter Settings**.  
Let's set Prescaler = 0.
Suppose that the PWM frequency is chosen equal to 10 KHz, then :  

The calculated value of TIM_Period must be less than 65535 which represents the value maximum that can be put in a 16-bit register. In order to meet this requirement, you will need to choose **Prescaler** in **Counter Settings**.
Let's set Prescaler = 0.
Suppose that the PWM frequency is chosen equal to 10 KHz, then :

**TIM_Period= 64 000 000 / 10 000 -1 = 6399**  
The value of the Duty Cycle will be between [ 0 and 6399 ], let's take this value very close to **50%**, it will be around **3199**.    

The calculated values will be entered during the definition of the TIMERx parameters in STM32CubeMX.

The Commande to start the PWM is :  
**HAL_TIM_PWM_Start( &htimx, TIM_CHANNEL_1 );**

During the execution of the main program, it is sometimes necessary to modify the Duty Cycle, So two instructions from the **__HAL** library will be needed to vary duty_cycle :  

**__HAL_TIM_GET_AUTORELOAD(&htimx);**  
**__HAL_TIM_SET_COMPARE(&htimx, TIM_CHANNEL_1, duty_cycle);**

